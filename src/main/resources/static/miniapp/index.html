<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Telegram Music Cloud</title>
<script src="https://telegram.org/js/telegram-web-app.js"></script>

<style>
body {
    margin:0;
    background:#0f0f0f;
    font-family:Arial,sans-serif;
    color:#fff;
}

/* HEADER */
.header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    padding:16px 20px;
    background:#1a1a1a;
    border-bottom:1px solid #333;
}
.header-title { font-size:22px; font-weight:bold; }
.search-box input {
    padding:8px 12px;
    border-radius:6px;
    border:none;
    background:#222;
    color:#fff;
}

/* LAYOUT */
.layout { padding:15px; }

/* MENU */
.library-menu {
    display:flex;
    gap:10px;
    margin-bottom:15px;
}
.menu-btn {
    background:#1e1e1e;
    border:1px solid #333;
    color:#aaa;
    padding:8px 16px;
    border-radius:20px;
    cursor:pointer;
}
.menu-btn.active {
    background:#fff;
    color:#000;
}

/* TRACK LIST */
.songs-container {
    background:#121212;
    border-radius:12px;
    padding:10px;
}

.track-item {
    display:grid;
    grid-template-columns:30px 1fr auto auto;
    gap:12px;
    padding:12px;
    border-radius:10px;
    cursor:pointer;
}
.track-item:hover { background:#1b1b1b; }

.track-title { font-size:14px; font-weight:600; }
.track-artist { font-size:12px; color:#aaa; }

.play-btn {
    width:36px;
    height:36px;
    border-radius:50%;
    border:1px solid #555;
    background:none;
    color:white;
    cursor:pointer;
}

.more-btn {
    background:none;
    border:none;
    color:#aaa;
    font-size:20px;
    cursor:pointer;
}

/* MINI PLAYER */
.mini-player {
    position:fixed;
    bottom:0;
    left:0;
    width:100%;
    background:#1b1b1b;
    border-top:1px solid #333;
    padding:10px 15px;
}
.mini-player.hidden { display:none; }

/* SPA VIEWS */
.view { display:none; }
.view.active { display:block; }

/* PLAYLIST GRID */
.playlists-grid {
    display:grid;
    grid-template-columns:repeat(2,1fr);
    gap:14px;
}
.playlist-card {
    background:#1a1a1a;
    border-radius:14px;
    aspect-ratio:1/1;
    display:flex;
    align-items:center;
    justify-content:center;
    font-weight:600;
    cursor:pointer;
}
.playlist-card:hover { background:#222; }

/* MODAL */
#playlist-modal {
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.6);
    display:none;
    align-items:center;
    justify-content:center;
    z-index:10000;
}

#audio-player { display:none; }
</style>
</head>

<body>

<div class="header">
    <div class="header-title">Telegram Music Cloud</div>
    <div class="search-box">
        <input type="text" placeholder="–ü–æ–∏—Å–∫...">
    </div>
</div>

<div class="layout">
    <div class="songs-container">

        <div class="library-menu">
            <button class="menu-btn active" id="btn-library">üéµ –ë–∏–±–ª–∏–æ—Ç–µ–∫–∞</button>
            <button class="menu-btn" id="btn-playlists">üìÇ –ü–ª–µ–π–ª–∏—Å—Ç—ã</button>
        </div>

        <div id="library-view" class="view active">
            <div id="track-list"></div>
        </div>

        <div id="playlists-view" class="view"></div>

    </div>
</div>

<!-- MODAL -->
<div id="playlist-modal">
    <div style="background:#1a1a1a;padding:20px;border-radius:14px;width:80%;max-width:320px;">
        <h3 style="margin-top:0">–ù–æ–≤—ã–π –ø–ª–µ–π–ª–∏—Å—Ç</h3>
        <input id="playlist-name-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ"
            style="width:100%;padding:10px;border-radius:8px;border:none;background:#222;color:white;margin-bottom:12px;">
        <button onclick="submitPlaylist()"
            style="width:100%;padding:10px;border-radius:10px;border:none;background:white;color:black;font-weight:bold;">
            –°–æ–∑–¥–∞—Ç—å
        </button>
    </div>
</div>

<audio id="audio-player"></audio>

<script>
const tg = window.Telegram.WebApp;
tg.ready();
tg.expand();

const apiBase = "https://telegram-music-player-uh5o.onrender.com";

const btnLibrary = document.getElementById("btn-library");
const btnPlaylists = document.getElementById("btn-playlists");
const libraryView = document.getElementById("library-view");
const playlistsView = document.getElementById("playlists-view");

btnLibrary.onclick = () => switchView("library");
btnPlaylists.onclick = () => switchView("playlists");

function switchView(v){
    libraryView.classList.toggle("active", v==="library");
    playlistsView.classList.toggle("active", v==="playlists");
    btnLibrary.classList.toggle("active", v==="library");
    btnPlaylists.classList.toggle("active", v==="playlists");

    if (v === "playlists") loadPlaylists();
}

async function loadPlaylists() {
    const r = await fetch(`${apiBase}/api/playlists`, {
        headers: { "X-TG-INIT-DATA": tg.initData }
    });
    const playlists = await r.json();

    playlistsView.innerHTML = `
        <div class="playlists-grid">
            <div class="playlist-card" id="create-playlist">‚ûï –ù–æ–≤—ã–π</div>
            ${playlists.map(p => `<div class="playlist-card">${p.name}</div>`).join("")}
        </div>
    `;

    document.getElementById("create-playlist").onclick = createPlaylist;
}

function createPlaylist() {
    document.getElementById("playlist-modal").style.display = "flex";
    document.getElementById("playlist-name-input").focus();
}

async function submitPlaylist() {
    const input = document.getElementById("playlist-name-input");
    const name = input.value.trim();
    if (!name) return;

    await fetch(`${apiBase}/api/playlists`, {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "X-TG-INIT-DATA": tg.initData
        },
        body: JSON.stringify({ name })
    });

    input.value = "";
    document.getElementById("playlist-modal").style.display = "none";
    loadPlaylists();
}
</script>

</body>
</html>
